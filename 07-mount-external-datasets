#!/bin/sh -x

. /usr/local/etc/host-init/jail-vars.sh

# this is where we mount the repo
# why externally mounted and not internal?
# I don't know. No real reason.

# set the mountpoint in the jail
# I don't know if this adjust canmount for all childen
zfs set mountpoint=${jailroot}/${INGRESS_JAIL}  ${jailzpool}/freshports/${INGRESS_JAIL}


zfs mount ${jailzpool}/freshports/${INGRESS_JAIL}/var/db/freshports/repos
zfs mount ${jailzpool}/freshports/${INGRESS_JAIL}/var/db/ingress/repos

if [ ! -d ${jailroot}/${INGRESS_JAIL}/var/db/freshports/ports-jail/var/db/repos ]
then
  echo ${jailroot}/${INGRESS_JAIL}/var/db/freshports/ports-jail/var/db/repos does not exist
  exit 12
fi

# check out head if it does not already exist
if [ ! -d "${jailroot}/${INGRESS_JAIL}/var/db/freshports/ports-jail/var/db/repos/PORTS-head" ]
then
  echo directory does not exist
  cd ${jailroot}/${INGRESS_JAIL}/var/db/freshports/ports-jail/var/db/repos
  svn co svn://svn.freebsd.org/ports/head PORTS-head
else
  echo PORTS-head already exists
fi

